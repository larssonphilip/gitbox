
Gitbox needs to perform several updates to be in sync with the Git repository:

1. Stage
2. Submodules
3. Local refs
4. Remote refs
5. Commits (history): depends on state of:
   - local ref
   - selected remote ref
   - search state


These tasks should be performed both on demand and independently of the UI. 
System should try to take FSEvents as hints, but still rely on its own timers and "isEqual" check for updated state 
(so it does not update again when nothing's changed).


Solution:

1. If FS event kicks in perform the local state update.
2. If FS event kicks in and we have an update scheduled in the future - do nothing.
3. After local state update is finished, schedule another updater after short interval.
4. If nothing has changed since last update, increase the interval and repeat.
5. If interval gets big enough, schedule a delay (to skip remaining ping/pong fs events), but do not update again. And after that delay accept fs events again.
6. For non-selected repos interval cutoff should be bigger than for selected to prevent ping-pong loop with submodules and nested repos.

Alternatively: simply delay ignoring FS events for some time when no actual change was detected. Don't increase that interval, but maybe make the interval bigger for non-selected repos.


Solution 2:

	Selected Repository:

		FS Event:
		+ if ignoring fs events, skip
		+ if there's scheduled update, skip
		+ if there's running update, skip
		+ schedule update after 0.0 seconds.

		Update scheduled:
		+ override delay

		Update started:
		+ if update is running, put into a pending block

		Update finished:
		+ run and clear pending block
		+ if something's changed, schedule an update after 0.0 sec.
		+ if nothing's changed 1st time, schedule an update later after 0.5 sec.
		+ if nothing's changed 2nd time, do not schedule
		+ ignore FS events for 1 second.

		Repo unselected:
		+ do nothing
		
		Window focused:
		+ schedule update after 0.0 seconds
		
	Non-selected Repository:
	
		FS Event:
		+ if ignoring fs events, skip
		+ if there's scheduled update, skip
		+ if there's running update, skip
		+ schedule update after 0.0 seconds.

		Update scheduled:
		+ override delay

		Update started:
		+ if update is running, put into a pending block

		Update finished:
		+ run and clear pending block
		+ if something's changed, schedule an update immediately.
		+ if nothing's changed, do not schedule again.
		+ ignore FS events for 5 seconds.
	
		Repo selected:
		+ reset ignore FS events interval










